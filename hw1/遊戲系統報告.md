# 網路程式設計作業報告

**學號**: 112550134  
**姓名**: 賴儁樞  
**日期**: 2025年10月10日

---

## 1. 系統架構 (System Architecture)

### 1.1 Lobby 伺服器

- **功能**: 用戶管理、認證、統計追蹤
- **通信協定**: TCP Socket (Port 12000)
- **主要服務**:
  - 用戶註冊 (`register`)
  - 用戶登入 (`login`)
  - 統計更新 (`update_stats`)
  - 經驗值兌換 (`exchange_xp`)

### 1.2 P2P 遊戲連接

**PlayerA** (主動發起方):

- UDP 掃描玩家 (Port 10000-10020)
- 建立 TCP 伺服器等待連接

**PlayerB** (被動接收方):

- UDP 監聽等待邀請
- TCP 客戶端連接到 PlayerA

### 1.3 資料庫系統

- **格式**: JSON 檔案 (users.json)
- **用戶資料結構**:
```json
{
  "username": {
    "password": "hashed_password",
    "login_count": 0,
    "experience_points": 0,
    "level": 1,
    "in_game_currency": 100
  }
}
```

---

## 2. 通信協定 (Communication Protocol)

### 2.1 Lobby 通信 (TCP + JSON)

**用戶註冊**:
```json
請求: {"action": "register", "username": "玩家名", "password": "密碼"}
回應: {"status": "success/error", "message": "結果訊息"}
```

**用戶登入**:
```json
請求: {"action": "login", "username": "玩家名", "password": "密碼"}
回應: {
  "status": "success/error",
  "user_data": {
    "username": "玩家名",
    "level": 1,
    "experience_points": 250
  }
}
```

### 2.2 P2P 遊戲通信

**UDP 掃描與邀請**:
```json
掃描: {"type": "scan", "from": "PlayerA"}
邀請: {"type": "invitation", "from": "PlayerA", "message": "遊戲邀請"}
回應: {"type": "invitation_response", "accepted": true/false}
```

**TCP 遊戲訊息**:
```json
選擇: {"type": "player_choice", "choice": "rock", "player": "player_a"}
結果: {"type": "final_game_result", "final_winner": "player_a", "game_over": false}
```

### 2.3 超時機制

- **UDP 邀請超時**: 10 秒
- **TCP 連接超時**: 30 秒
- **握手驗證超時**: 10 秒

---

## 3. 遊戲玩法 (Game Rules)

### 3.1 遊戲概述

**黑白切** - 兩階段對戰遊戲：猜拳 + 猜方向

### 3.2 第一階段：猜拳

- **選項**: 剪刀(1) / 石頭(2) / 布(3)
- **勝負規則**:
  - 剪刀 勝 布
  - 石頭 勝 剪刀
  - 布 勝 石頭
  - 平手則重新猜拳

### 3.3 第二階段：方向選擇

- **選項**: 上(4) / 下(5) / 左(6) / 右(7)
- **選擇順序**:
  - 猜拳輸的人先選方向
  - 猜拳贏的人後選方向
- **勝負判定**:
  - 相同方向 → 猜拳贏家獲勝
  - 不同方向 → 平手

### 3.4 計分與結束

**計分系統**:

- 單局獲勝: +1 分
- 平手: 不加分
- 遊戲目標: 先達 3 分者勝利

**結束條件**:

1. 任一玩家達到 3 分
2. 玩家中途退出
3. 連接中斷

**獎勵機制**:

*單局獎勵*:

- 獲勝: +50 XP, +10 幣
- 平手: +30 XP
- 失敗: +20 XP, -10 幣

*最終獎勵*:

- 獲勝: +500 XP
- 失敗: -100 XP
- 中途退出: -100 XP

---
